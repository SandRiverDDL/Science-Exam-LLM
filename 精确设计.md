ä¸‹é¢ç»™ä½ ä¸€ä¸ª **å¯ç›´æ¥å–‚ç»™ AI ç¼–ç çš„ SOTA æ–¹æ¡ˆ**ï¼Œæ ¼å¼ä¸ºâ€œæ˜ç¡®æ­¥éª¤ + ä¸å«å¤šä½™è§£é‡Š + ä¿è¯èƒ½è®©æ¨¡å‹æŒ‰åºå®ç°â€ã€‚
æ•´ä¸ªæ–¹æ¡ˆåˆ†ä¸ºï¼šæ•°æ®å‡†å¤‡ â†’ æ£€ç´¢ â†’ æ’åº â†’ LLM æ¨ç†æ¨¡å‹ â†’ æ¨ç†å¢å¼º â†’ è¾“å‡ºã€‚

---

# ğŸ”¥ **SOTA æ–¹æ¡ˆï¼ˆå¯ç›´æ¥ç»™ AI ç¼–ç å®ç°çš„æ‰§è¡Œç‰ˆï¼‰**

## ============================================

# **1. æ•°æ®åŠ è½½ä¸é¢„å¤„ç†**

## ============================================

1. åŠ è½½è®­ç»ƒé›†ã€éªŒè¯é›†ã€æµ‹è¯•é›† CSV

   * å­—æ®µåŒ…æ‹¬ï¼šquestionã€options(A~E)ã€context æˆ–èƒŒæ™¯æ–‡æœ¬ï¼ˆå¦‚æœæœ‰ï¼‰ã€correct_answerï¼ˆè®­ç»ƒé›†ï¼‰

2.æ–‡æœ¬åˆ†å—ï¼ˆchunkingï¼‰
æ–‡æœ¬å†…å®¹æ¥è‡ª data\raw\articles
å¯¹æ‰€æœ‰åŸå§‹æ–‡æ¡£è¿›è¡Œ chunk å¤„ç†ï¼š

chunk_size = 256 tokens
chunk_overlap = 50 tokens

æ“ä½œæ–¹æ³•ï¼š

ä½¿ç”¨ langchain.text_splitter.RecursiveCharacterTextSplitter æˆ–ç­‰ä»·è‡ªå®šä¹‰ splitter

åˆ†å‰²æ¯æ®µæ–‡æœ¬ä¸º token çº§åˆ«çš„ chunks

æ¯ä¸ª chunk é™„å¸¦ metadataï¼š

chunk_id

doc_id

positionï¼ˆchunk çš„é¡ºåºï¼‰

3. å¯¹æ‰€æœ‰ chunks ç”Ÿæˆä¸‰ç§ embeddingï¼š

   * Jina-embeddings-v4 (text-retrieval)
   * BGE-m3 æˆ– bge-large-v1.5
   * e5-mistral-instruct
   å…·ä½“æ¥è¯´multilingual-e5-large-instruct Alibaba-NLP/gte-multilingual-baseï¼Œä¸”è¿™ä¸¤è€…æˆ‘å·²ç»ä¸‹è½½å¥½äº†ï¼Œæ³¨æ„Jina-embeddings-v4æ˜¯ä¸»åŠ›

4. ä¿å­˜ embedding åˆ° FAISS ç´¢å¼•

   * å¯¹æ¯ä¸ª embedding åˆ†åˆ«åˆ›å»ºä¸€ä¸ª IndexFlatIP (FP16)
   * ä¿å­˜ idâ†’chunk_textã€idâ†’metadata æ˜ å°„

---

## ============================================

# **2. å¤šè·¯æ£€ç´¢ï¼ˆmulti-embedding retrievalï¼‰**

## ============================================

ç»™æ¯ä¸ªé—®é¢˜æ‰§è¡Œä¸‹åˆ—æ­¥éª¤ï¼š

1. ç”¨ä¸‰ç§ embedding åˆ†åˆ«ç¼–ç  question
2. åœ¨å„è‡ªçš„ FAISS ç´¢å¼•ä¸­æœç´¢ top-Kï¼ˆå»ºè®® K = 50~100ï¼‰
3. å¾—åˆ°ä¸‰ä¸ªå€™é€‰åˆ—è¡¨ï¼šlist_jina, list_bge, list_e5

---

## ============================================

# **3. Rank Fusionï¼ˆæ’åºèåˆï¼‰**

## ============================================

å¯¹ä¸‰ä¸ªæ£€ç´¢åˆ—è¡¨æ‰§è¡Œ **RBF èåˆ**ï¼š

```
score = sum( exp( - rank_i / alpha ) )
alpha = 5ï¼ˆè¶…å‚ï¼‰
```

æ’åºåå– top-M æ–‡æœ¬ï¼ˆM = 5~10ï¼‰ã€‚

æŠŠè¿™äº›æ–‡æœ¬æ‹¼æ¥æˆ final_contextã€‚

---

## ============================================

# **4. Rerankerï¼ˆäº¤å‰ç¼–ç å™¨ï¼‰**

## ============================================

1. åŠ è½½ cross-encoder rerankerï¼š

   * Jina Reranker v3ï¼ˆæ¨èï¼‰
2. å¯¹ fusion å¾—åˆ°çš„ top-M æ–‡æœ¬é‡æ–°æ’åº
3. å– reranker æ’åºåçš„ top-N æ–‡æœ¬ï¼ˆN = 3~5ï¼‰
4. æ‹¼æ¥æˆæœ€ç»ˆè¾“å…¥ç»™ LLM çš„ context

---

## ============================================

# **5. LLM åˆ†ç±»å™¨æ¨¡å‹ï¼ˆæ ¸å¿ƒæ¨¡å‹ï¼‰**

## ============================================

### 5.1 åŸºç¡€æ¨¡å‹

åŠ è½½ï¼š

* Qwen3-8B-Instruct æˆ– Qwen3-8B-Instruct-QAT æ¨¡å‹ï¼ˆFP8 æˆ– INT4 é‡åŒ–å‡å¯ï¼‰

### 5.2 Two-stage å¾®è°ƒæµç¨‹

ï¼ˆè®­ç»ƒé˜¶æ®µæ‰§è¡Œï¼Œæ¨ç†æ—¶ä¸å†è¿›è¡Œï¼‰

#### Stage Aï¼ˆLLM å†»ç»“ï¼‰

1. LLM å†»ç»“å…¨éƒ¨å‚æ•°
2. æ„å»º MLP åˆ†ç±»å™¨

   * è¾“å…¥ç»´åº¦ = hidden_dim
   * ç»“æ„ï¼šLinear â†’ GELU â†’ Linear â†’ è¾“å‡º logitsï¼ˆ5 ç±»ï¼‰
3. æå– LLM hidden stateï¼ˆæœ€åä¸€å±‚ï¼‰ä¸­ option span çš„ mean pooling
4. è®­ç»ƒ MLP ç›´åˆ°æ”¶æ•›

#### Stage Bï¼ˆLoRA + MLPï¼‰

1. å¯¹ LLM çš„ q_proj, k_proj, v_proj, o_proj æ³¨å…¥ LoRA

   * r = 16 or 32
   * alpha = 32
   * dropout = 0.05
2. LLM+MLP åŒæ—¶è®­ç»ƒ
3. ä¿å­˜æœ€ç»ˆæ¨¡å‹ï¼ˆLLM + LoRA + MLPï¼‰

---

## ============================================

# **6. æ¨ç†æ ¼å¼ï¼ˆä¸€æ¬¡ forward å¾—åˆ°äº”ä¸ª logitsï¼‰**

## ============================================

æ„é€ è¾“å…¥ï¼š

```
[QUESTION]
<question_text>

[OPTIONS]
<opt id="A"> option A text </opt>
<opt id="B"> option B text </opt>
<opt id="C"> option C text </opt>
<opt id="D"> option D text </opt>
<opt id="E"> option E text </opt>

[CONTEXT]
<context_text>
```

æ­¥éª¤ï¼š

1. å¯¹è¾“å…¥æ‰§è¡Œ tokenizerï¼Œæ”¶é›†æ¯ä¸ª option çš„èµ·æ­¢ token index
2. forward LLMï¼Œè®¾ç½® output_hidden_states=True
3. å¯¹æ¯ä¸ª option çš„ span åš mean pooling å¾—åˆ° 5 ä¸ªå‘é‡
4. æŠŠæ¯ä¸ªå‘é‡é€å…¥ MLPï¼Œå¾—åˆ° 5 ä¸ª logits
5. å¯¹ logits æ‰§è¡Œ softmax â†’ æ¦‚ç‡ â†’ argmax å¾—åˆ°æœ€ç»ˆç­”æ¡ˆï¼ˆA~Eï¼‰

---

## ============================================

# **7. TTAï¼ˆTest-Time Augmentationï¼‰**

## ============================================

<!-- å¯¹æ¯ä¸ªé—®é¢˜æ‰§è¡Œ K æ¬¡ï¼ˆK=3 æˆ– 5ï¼‰ï¼š -->
å¯¹æ¯ä¸ªé—®é¢˜æ‰§è¡Œ 5 æ¬¡
<!-- 1. éšæœºæ‰“ä¹± A~E çš„é¡ºåº -->
1.æ‰“ä¹±A-Eé¡ºåºï¼Œä¾‹å¦‚ A-B-C-D-E ç„¶åç¬¬äºŒè½®å°±æ˜¯ B-C-D-E-Aï¼Œä»¥æ­¤ç±»æ¨
2. é‡æ„ option spans
3. å‰å‘å¾—åˆ° logits
4. å°† logits æŒ‰åŸé¡ºåºé€†æ˜ å°„ä¸ºåŸå§‹ A~E
5. èåˆæ‰€æœ‰ logitsï¼ˆæ±‚å¹³å‡ï¼‰

---

## ============================================

# **8. æ¸©åº¦æ ¡å‡†ï¼ˆTemperature Scalingï¼‰**

## ============================================

åœ¨éªŒè¯é›†ä¸Šæ‹Ÿåˆä¸€ä¸ªæ ‡é‡æ¸©åº¦ Tï¼š

```
p = softmax(logits / T)
```

T é€šè¿‡æœ€å°åŒ–éªŒè¯é›† NLL æ‹Ÿåˆä¸€æ¬¡ã€‚

æ¨ç†æ—¶ï¼š

```
final_probs = softmax(final_logits / T)
```

---

## ============================================

# **9. æœ€ç»ˆç­”æ¡ˆè¾“å‡º**

## ============================================

å¯¹äºæ¯è¡Œ testï¼š

1. ç»è¿‡æ£€ç´¢
2. æ’åºèåˆ
3. reranker
4. LLM hidden classifier
5. å¤šæ¬¡ TTA
6. æ¸©åº¦æ ¡å‡†
7. è¾“å‡ºæ¦‚ç‡æœ€é«˜çš„ A/B/C/D/E

å°†ç»“æœå†™å…¥ï¼š

```
submission.csv:
question_id, answer
```

---

## ============================================

# **10. Kaggle Notebook æäº¤æµç¨‹**

## ============================================

Notebook å¿…é¡»æ‰§è¡Œä»¥ä¸‹æµç¨‹ï¼š

1. ä» `/kaggle/input/your-dataset/` åŠ è½½ï¼š

   * FAISS ç´¢å¼•
   * æ–‡æœ¬ chunks
   * LLM æ¨¡å‹
   * LoRA æƒé‡
   * MLP classifier æƒé‡

2. åŠ è½½ test.csv

3. å¯¹æ¯ä¸ªæ ·æœ¬è¿è¡Œæ­¥éª¤ 2~9

4. å†™å…¥ `/kaggle/working/submission.csv`

5. ç»“æŸè¿è¡Œç”± Kaggle è‡ªåŠ¨è¯„åˆ†

---

# ğŸ”¥ æœ€ç»ˆæ€»ç»“ï¼ˆå•æ®µå…³é”®æµç¨‹ï¼Œå¯ç›´æ¥æ‰§è¡Œï¼‰

```
å¤šè·¯ embeddingï¼ˆJina+BGE+e5ï¼‰ â†’ FAISS topK  
â†’ RBF èåˆ â†’ Jina Reranker topN  
â†’ æ„é€  promptï¼ˆquestion + 5 options + contextï¼‰  
â†’ LLM forward å¾—åˆ° hidden states  
â†’ span poolingï¼ˆ5 ç±»ï¼‰  
â†’ MLP ç”Ÿæˆ logits  
â†’ TTA (K æ¬¡ shuffle) â†’ logits å¹³å‡  
â†’ æ¸©åº¦æ ¡å‡† softmax  
â†’ argmax è¾“å‡º A/B/C/D/E  
```

---

å¦‚æœä½ éœ€è¦ï¼Œæˆ‘è¿˜å¯ä»¥æä¾›ï¼š

### âœ” å®Œæ•´çš„ Python ç›®å½•ç»“æ„

### âœ” æ¨ç†è„šæœ¬ï¼ˆå¯ç›´æ¥è¿è¡Œï¼‰

### âœ” Kaggle Notebook æ¨¡æ¿ï¼ˆç›´æ¥æäº¤ç‰ˆï¼‰

å‘Šè¯‰æˆ‘ä½ æƒ³è¦å“ªä¸€ä¸ªã€‚
